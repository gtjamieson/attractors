<!DOCTYPE html>
<html lang="en">
	<head>
		<!-- GJ Meta -->
		<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
		<meta content="utf-8" http-equiv="encoding">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<link rel="icon" type="image/png" href="https://storage.googleapis.com/enakr8ia_habitat/metagame_enkr8ia_360px.png">

		<link rel="stylesheet" type="text/css" href="https://storage.googleapis.com/enakr8ia_habitat/source_files/attractors-master/sim/sim.css">
		<!-- GJ Style
		<link rel="stylesheet" type="text/css" href="https://storage.googleapis.com/enakr8ia_habitat/source_files/attractors-master/index.css">
-->
	</head>
	<body>


<!-- Placeholder labels...
<div style="display:none">
	<span id="label_population">
		POPULATION:
	</span>
	<span id="label_catchFish">
		– CATCH FISH!
	</span>
	<span id="label_releaseFish">
		+ RELEASE FISH!
	</span>
	<span id="label_underpopulation">
		death by<br>underpopulation
	</span>
	<span id="label_overpopulation">
		death by<br>overpopulation
	</span>
	<span id="label_population_grows">
		population<br>grows!
	</span>
</div>
<script src="https://storage.googleapis.com/enakr8ia_habitat/source_files/attractors-master/index.js"></script>
-->

<script src="https://storage.googleapis.com/enakr8ia_habitat/source_files/attractors-master/sim/Mouse.js"></script>
<script src="https://storage.googleapis.com/enakr8ia_habitat/source_files/attractors-master/sim/helpers.js"></script>
<script src="https://storage.googleapis.com/enakr8ia_habitat/source_files/attractors-master/sim/howler.min.js"></script>
<!-- Mute all Howler sounds globally -->
<script>
  // Either mute completely:
  Howler.mute(true);

  // Or set global volume to 0 (equivalent in effect):
  // Howler.volume(0);

  // Optional: enable via URL param, e.g., ?mute=1
  // if (new URLSearchParams(location.search).get('mute') === '1') Howler.mute(true);
</script>
<script src="https://storage.googleapis.com/enakr8ia_habitat/source_files/attractors-master/sim/Attractors.js"></script>

<!-- GJ: Responsive scaling — activates only when ?responsive=1 is in the URL -->
<!-- Native iOS/Android apps omit this param and are unaffected -->
<script>
if (new URLSearchParams(location.search).get('responsive') === '1') {

  window.gjScale = 1;
  window.gjAvailH = 9999; // unconstrained until parent sends actual value
  var gjTouchFixed = false;

  // Listen for available height from parent page (sent on load and on rotation)
  window.addEventListener('message', function(e) {
    if (e.data && e.data.type === 'gjAvailHeight') {
      window.gjAvailH = e.data.availH;
      gjScaleCanvas();
    }
  });

  function gjFixTouchCoords(canvas) {
    if (gjTouchFixed) return;
    gjTouchFixed = true;
    function gjTouchWrapper(callback) {
      return function(event) {
        var rect = canvas.getBoundingClientRect();
        var touch = event.changedTouches[0];
        var _event = {
          offsetX: (touch.clientX - rect.left) / window.gjScale,
          offsetY: (touch.clientY - rect.top) / window.gjScale
        };
        event.stopImmediatePropagation();
        event.preventDefault();
        callback(_event);
      };
    }
    canvas.addEventListener('touchstart', gjTouchWrapper(Mouse.ondown), true);
    canvas.addEventListener('touchmove', gjTouchWrapper(Mouse.onmove), true);
    document.body.addEventListener('touchend', Mouse.onup, true);
  }

  function gjScaleCanvas() {
    var c = document.getElementById('canvas');
    if (!c) return;
    var h = parseInt(c.style.height) || 600;
    var scaleW = window.innerWidth / 400;
    var scaleH = window.gjAvailH / h;
    var scale = Math.min(scaleW, scaleH);
    window.gjScale = scale;
    c.style.transformOrigin = 'top left';
    c.style.transform = 'scale(' + scale + ')';
    var scaledHeight = Math.round(h * scale);
    document.body.style.height = scaledHeight + 'px';
    document.body.style.overflow = 'hidden';
    gjFixTouchCoords(c);
    // Tell parent page the actual rendered height
    if (window.parent !== window) {
      window.parent.postMessage({ type: 'gjSimHeight', height: scaledHeight }, '*');
    }
  }

  window.addEventListener('load', function() { setTimeout(gjScaleCanvas, 50); });
  window.addEventListener('resize', gjScaleCanvas);
}
</script>

</body>

</html>
